{% extends "base.html" %}

{% block title %}Login | {{ app_name }}{% endblock %}
{% block body_class %}page-login{% endblock %}
{% block main_class %}login-main{% endblock %}

{% block header_icon %}<i class="fas fa-key"></i>{% endblock %}
{% block header_title %}{{ app_name }}{% endblock %}
{% block header_actions %}
  <div class="time-date-container">
    <div class="time-display" id="liveClock">00:00:00</div>
    <div class="date-display">
      <i class="fas fa-calendar-alt"></i>
      <span id="liveDate">Loading...</span>
    </div>
  </div>
{% endblock %}

{% block content %}
  <div class="orb-layer" aria-hidden="true">
    <div class="orb one"></div>
    <div class="orb two"></div>
    <div class="orb three"></div>
  </div>

  <div class="login-layout">
    <section class="hero-panel">
      <div>
        <span class="hero-badge"><i class="fas fa-shield-halved"></i> Secure License Platform</span>
        <h1 class="hero-title">Manage machine licenses, operators, and audit-ready key generation</h1>
        <p class="hero-subtitle">Centralized license workflow with secure sign-in and role-based access for your operations team.</p>
        <div class="hero-feature-list">
          <span><i class="fas fa-check-circle"></i> Machine-based key generation</span>
          <span><i class="fas fa-check-circle"></i> Mongo + local persistence</span>
          <span><i class="fas fa-check-circle"></i> User access control</span>
          <span><i class="fas fa-check-circle"></i> Live dashboard analytics</span>
        </div>
      </div>
    </section>

    <section class="login-column">
      {% if messages %}
        <div class="messages-wrap">
          {% for msg in messages %}
            <div class="alert alert-{{ msg.tags }} alert-dismissible fade show" role="alert">
              {{ msg }}
              <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
          {% endfor %}
        </div>
      {% endif %}

      <div class="login-card">
        <div class="login-card-header">
          <div class="logo-container">
            <div class="logo-circle">
              <i class="fas fa-user-lock"></i>
            </div>
            <div class="logo-text">
              <h1>{{ app_name }}</h1>
              <span>{{ app_tagline }}</span>
            </div>
          </div>
          <div class="welcome-text">
            <h2>Secure Authentication</h2>
            <p>Sign in to continue</p>
          </div>
        </div>

        <div class="card-body">
          <div class="login-form">
            <h3>Login</h3>

            <form method="post">
              {% csrf_token %}

              {% if error %}
                <div class="error-message">
                  <i class="fas fa-exclamation-triangle"></i>
                  <span>{{ error }}</span>
                </div>
              {% endif %}

              <div class="form-group">
                <label for="username">Username</label>
                <div class="input-with-icon">
                  <i class="fas fa-user"></i>
                  <input type="text" id="username" name="username" required value="{{ username|default:'' }}" placeholder="Enter your username">
                </div>
              </div>

              <div class="form-group">
                <label for="password">Password</label>
                <div class="input-with-icon">
                  <i class="fas fa-lock"></i>
                  <input type="password" id="password" name="password" required placeholder="Enter your password">
                  <i class="fas fa-eye toggle-password" onclick="togglePassword()"></i>
                </div>
              </div>

              <button type="submit" class="login-btn">
                <i class="fas fa-sign-in-alt"></i>
                <span>Login to Dashboard</span>
              </button>
            </form>
          </div>
        </div>
      </div>
    </section>
  </div>

  <footer class="app-footer">
    <span><i class="fas fa-cube"></i> {{ app_name }} {{ app_version }}</span>
    <span><i class="far fa-copyright"></i> 2026 MahilTechLab</span>
  </footer>
{% endblock %}

{% block scripts %}
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function togglePassword() {
      const pwd = document.getElementById("password");
      const eye = document.querySelector(".toggle-password");
      if (!pwd || !eye) return;
      if (pwd.type === "password") {
        pwd.type = "text";
        eye.classList.remove("fa-eye");
        eye.classList.add("fa-eye-slash");
      } else {
        pwd.type = "password";
        eye.classList.remove("fa-eye-slash");
        eye.classList.add("fa-eye");
      }
    }

    function fmt(value) {
      return value < 10 ? "0" + value : value;
    }

    function updateDateTime() {
      const now = new Date();
      const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
      const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
      const liveClock = document.getElementById("liveClock");
      const liveDate = document.getElementById("liveDate");
      if (liveClock) {
        liveClock.textContent = fmt(now.getHours()) + ":" + fmt(now.getMinutes()) + ":" + fmt(now.getSeconds());
      }
      if (liveDate) {
        liveDate.textContent = days[now.getDay()] + ", " + months[now.getMonth()] + " " + now.getDate() + ", " + now.getFullYear();
      }
    }

    document.addEventListener("DOMContentLoaded", function() {
      updateDateTime();
      setInterval(updateDateTime, 1000);
      setTimeout(function() {
        document.querySelectorAll(".alert").forEach(function(alert) {
          alert.classList.remove("show");
          setTimeout(function() { alert.remove(); }, 300);
        });
      }, 5000);
    });
  </script>
{% endblock %}
